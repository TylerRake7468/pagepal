<h1><%= @book.title %></h1>
<p><strong>Author:</strong> <%= @book.author %></p>
<p><%= @book.description %></p>
<p><small>Uploaded by: <%= @book.user.email %></small></p>

<% if @book.image.attached? %>
  <div>
    <%= image_tag @book.image, alt: @book.title, size: "200x300" %>
  </div>
<% end %>

<% if user_signed_in? && current_user.recommendations.none? { |r| r.book_id == @book.id } %>
  <%= link_to "Recommend this Book", new_book_recommendation_path(@book), class: "btn btn-primary" %>
<% else %>
  <p><em>You have already recommended this book.</em></p>
<% end %>

<h2>Recommendations</h2>

<% @book.recommendations.each do |rec| %>
  <div class="p-2 border mb-2">
    <p><%= rec.review %></p>
    <p><small>By: <%= rec.user.email %></small></p>
    <p>
      Votes: <%= rec.votes_count %>
      <% if user_signed_in? %>
        <% if current_user.votes.exists?(recommendation: rec) %>
          <%= button_to "Remove Vote", recommendation_vote_path(rec), method: :delete %>
        <% else %>
          <%= button_to "Upvote", recommendation_vote_path(rec), method: :post %>
        <% end %>
      <% end %>
    </p>
  </div>
<% end %>



<%= link_to "Back to list", books_path %>
