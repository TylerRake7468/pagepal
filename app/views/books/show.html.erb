<div class="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-6">
  <div class="flex flex-col md:flex-row gap-6">
    
    <% if @book.image.attached? %>
      <div class="flex-shrink-0 w-full md:w-1/3">
        <%= image_tag @book.image, class: "w-full h-auto object-contain rounded" %>
      </div>
    <% end %>

    <div class="flex-1">
      <h1 class="text-3xl font-bold text-blue-700 mb-2"><%= @book.title %></h1>
      <p class="text-lg text-gray-700 mb-1"><strong>Author:</strong> <%= @book.author %></p>
      <p class="text-sm text-gray-600 mb-4"><strong>Uploaded by:</strong> <%= @book.user.email %></p>
      <p class="text-gray-800 text-base leading-relaxed"><%= @book.description %></p>

      <% if user_signed_in? && current_user.recommendations.none? { |r| r.book_id == @book.id } %>
        <%= link_to "Recommend This Book", new_book_recommendation_path(@book),
                    class: "mt-6 inline-block bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700" %>
      <% else %>
        <p class="mt-6 text-sm italic text-gray-500">You have already recommended this book.</p>
      <% end %>
    </div>
  </div>

  <hr class="my-6">

  <div>
    <h2 class="text-2xl font-semibold mb-4">Recommendations</h2>

    <% if @book.recommendations.any? %>
      <% @book.recommendations.each do |rec| %>
        <div class="bg-gray-50 border rounded p-4 mb-3 shadow-sm">
          <p class="text-gray-800"><%= rec.review %></p>

          <div class="text-sm text-gray-600 mt-2 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <span>‚Äî <%= rec.user.email %></span>

            <div class="flex items-center gap-3">
              <span>üëç <%= rec.votes_count %> votes</span>

              <% if user_signed_in? %>
                <% if current_user.votes.exists?(recommendation: rec) %>
                  <%= button_to "Remove Vote", recommendation_vote_path(rec),
                                method: :delete,
                                class: "text-sm text-red-600 bg-red-100 hover:bg-red-200 px-3 py-1 rounded" %>
                <% else %>
                  <%= button_to "Upvote", recommendation_vote_path(rec),
                                method: :post,
                                class: "text-sm text-green-700 bg-green-100 hover:bg-green-200 px-3 py-1 rounded" %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>

      <% end %>
    <% else %>
      <p class="text-gray-500 italic">No recommendations yet for this book.</p>
    <% end %>
  </div>

  <%= link_to "‚Üê Back to all books", books_path,
              class: "mt-6 inline-block text-blue-600 hover:underline" %>
</div>